<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solar Profile Quoting System</title>
  <style>
    /* Basic page styling */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    /* Header styling */
    header {
      position: relative;
      background: #333;
      color: #fff;
      overflow: hidden;
    }
    /* Animated SVG header chart */
    #headerChart {
      display: block;
      width: 100%;
      height: 120px; /* Adjust height as needed */
    }
    /* Scrolling group that duplicates the content */
    .scrolling {
      animation: scroll 15s linear infinite; /* 15s for slower scroll */
    }
    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-500px); }
    }
    /* Page title positioned below the animated chart */
    #pageTitle {
      text-align: center;
      padding: 0.5rem;
      background: #444;
      font-size: 1.5rem;
    }
    /* Container for multi-step content */
    .container {
      max-width: 800px;
      margin: 2rem auto;
      background: #fff;
      padding: 2rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    input, button, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <!-- Header: Animated chart on top, then page title -->
  <header>
    <svg id="headerChart" viewBox="0 0 500 100" preserveAspectRatio="none">
      <defs>
        <!-- We define partial and full season boxes so that Winter is split. -->
        <!-- Each "half" of Winter is 62.5px, while Spring/Summer/Autumn are 125px. -->
        <!-- This way the line can start in mid-Winter (x=31.25) and end in mid-Winter (x=468.75). -->
        <!-- Colors: winter=blue, spring=green, summer=orange, autumn=red -->
        <g id="chartContent">
          <!-- 1) Half Winter (start) = 0 to 62.5 -->
          <rect x="0" y="10" width="62.5" height="80" fill="blue" fill-opacity="0.5"/>
          <!-- 2) Spring = 62.5 to 187.5 -->
          <rect x="62.5" y="10" width="125" height="80" fill="green" fill-opacity="0.5"/>
          <!-- 3) Summer = 187.5 to 312.5 -->
          <rect x="187.5" y="10" width="125" height="80" fill="orange" fill-opacity="0.5"/>
          <!-- 4) Autumn = 312.5 to 437.5 -->
          <rect x="312.5" y="10" width="125" height="80" fill="red" fill-opacity="0.5"/>
          <!-- 5) Half Winter (end) = 437.5 to 500 -->
          <rect x="437.5" y="10" width="62.5" height="80" fill="blue" fill-opacity="0.5"/>

          <!-- Season labels above the boxes -->
          <text x="31.25"  y="8" font-size="12" text-anchor="middle" fill="blue">Winter</text>
          <text x="125"    y="8" font-size="12" text-anchor="middle" fill="green">Spring</text>
          <text x="250"    y="8" font-size="12" text-anchor="middle" fill="orange">Summer</text>
          <text x="375"    y="8" font-size="12" text-anchor="middle" fill="red">Autumn</text>
          <text x="468.75" y="8" font-size="12" text-anchor="middle" fill="blue">Winter</text>

          <!-- Paths for cost and solar curves -->
          <path id="costPath" fill="none" stroke="steelblue" stroke-width="2" />
          <path id="solarPath" fill="none" stroke="tomato" stroke-width="2" />
          <!-- Group for dynamic data labels -->
          <g id="dataLabels"></g>
        </g>
      </defs>
      <!-- Duplicate the chart content for seamless scrolling -->
      <g class="scrolling">
        <use href="#chartContent" x="0" y="0"></use>
        <use href="#chartContent" x="500" y="0"></use>
      </g>
    </svg>
    <div id="pageTitle">Solar Profile Quoting System</div>
  </header>

  <div class="container">
    <!-- Step 1: Seasonal Electricity Costs -->
    <section id="step1" class="active">
      <h2>Enter Your Seasonal Electricity Costs</h2>
      <form id="seasonForm">
        <label for="winterCost">Winter Electricity Cost ($):</label>
        <input type="number" id="winterCost" required />
        <label for="springCost">Spring Electricity Cost ($):</label>
        <input type="number" id="springCost" required />
        <label for="summerCost">Summer Electricity Cost ($):</label>
        <input type="number" id="summerCost" required />
        <label for="autumnCost">Autumn Electricity Cost ($):</label>
        <input type="number" id="autumnCost" required />
        <button type="button" onclick="handleSeasonalCosts()">Continue</button>
      </form>
    </section>

    <!-- Step 2: Location -->
    <section id="step2">
      <h2>Enter Your Location</h2>
      <form id="locationForm">
        <label for="location">Location (Address):</label>
        <input type="text" id="location" required />
        <button type="button" onclick="handleLocation()">Continue</button>
      </form>
    </section>

    <!-- Step 3: Example Quote -->
    <section id="step3">
      <h2>Example Quote</h2>
      <div id="quoteContent"></div>
      <button type="button" onclick="goToStep('step4')">Continue</button>
    </section>

    <!-- Step 4: Contact Us -->
    <section id="step4">
      <h2>Contact Us</h2>
      <form id="contactForm">
        <label for="contactName">Name:</label>
        <input type="text" id="contactName" required />
        <label for="contactEmail">Email:</label>
        <input type="email" id="contactEmail" required />
        <label for="contactMessage">Message:</label>
        <textarea id="contactMessage" rows="4" required></textarea>
        <button type="button" onclick="submitContact()">Continue</button>
      </form>
    </section>

    <!-- Step 5: Thank You -->
    <section id="step5">
      <h2>Thank You!</h2>
      <p>Thank you for using our Solar Profile Quoting System. We will be in touch soon.</p>
    </section>
  </div>

  <script>
    // Global object to store user data
    let userData = {};

    // Conversion factor and sunlight modifiers for each season
    const baseConversion = 0.2;
    const sunlightFactors = {
      winter: 1.2,
      spring: 1.0,
      summer: 0.8,
      autumn: 1.0
    };

    // Array of random customer names
    const customerNames = ["John Doe", "Jane Smith", "Alex Johnson", "Emily Davis", "Michael Brown"];

    // Example modular solar setups
    const solarSetups = [
      {
        name: "Basic 3kW Starter Kit",
        description: "8 x 375W panels, 3kW inverter, basic racking system",
        baseCost: 3000
      },
      {
        name: "Advanced 6kW System",
        description: "15 x 400W panels, 6kW inverter, battery-ready design",
        baseCost: 6000
      },
      {
        name: "Premium 10kW Package",
        description: "25 x 400W panels, 10kW hybrid inverter, optional battery add-on",
        baseCost: 10000
      },
      {
        name: "Off-Grid 5kW Setup",
        description: "12 x 420W panels, 5kW hybrid inverter, 10kWh battery storage",
        baseCost: 9000
      }
    ];

    // Helper to pick a random solar setup
    function getRandomSetup() {
      const idx = Math.floor(Math.random() * solarSetups.length);
      return solarSetups[idx];
    }

    // Step 1: Save seasonal cost data
    function handleSeasonalCosts() {
      const winter = parseFloat(document.getElementById('winterCost').value);
      const spring = parseFloat(document.getElementById('springCost').value);
      const summer = parseFloat(document.getElementById('summerCost').value);
      const autumn = parseFloat(document.getElementById('autumnCost').value);
      if ([winter, spring, summer, autumn].some(v => isNaN(v))) {
        alert("Please fill in all seasonal cost fields.");
        return;
      }
      userData.winterCost = winter;
      userData.springCost = spring;
      userData.summerCost = summer;
      userData.autumnCost = autumn;
      goToStep('step2');
    }

    // Step 2: Save location, select a random customer name, and calculate seasonal solar requirements
    function handleLocation() {
      const loc = document.getElementById('location').value;
      if (!loc) {
        alert("Please enter your location.");
        return;
      }
      userData.location = loc;
      // Use location as customer address
      userData.customerAddress = loc;
      // Select a random customer name
      const randomIdx = Math.floor(Math.random() * customerNames.length);
      userData.customerName = customerNames[randomIdx];

      // Update page title with location
      document.getElementById('pageTitle').textContent = 'Solar Profile for ' + loc;

      // Calculate seasonal solar requirements (formula can be adjusted)
      userData.solarRequirements = {
        winter: userData.winterCost * baseConversion * sunlightFactors.winter,
        spring: userData.springCost * baseConversion * sunlightFactors.spring,
        summer: userData.summerCost * baseConversion * sunlightFactors.summer,
        autumn: userData.autumnCost * baseConversion * sunlightFactors.autumn
      };

      // Compute an "average" required capacity (for simplicity)
      const avgCapacity = (
        userData.solarRequirements.winter +
        userData.solarRequirements.spring +
        userData.solarRequirements.summer +
        userData.solarRequirements.autumn
      ) / 4;
      userData.averageCapacity = avgCapacity;

      // Choose a random solar setup and scale cost by (avgCapacity/5)
      const chosenSetup = getRandomSetup();
      const scaleFactor = Math.max(1, avgCapacity / 5);
      const totalCost = (chosenSetup.baseCost * scaleFactor).toFixed(2);
      userData.chosenSetup = chosenSetup;
      userData.setupCost = totalCost;

      updateHeaderChart();
      goToStep('step3');

      // Compute today's date in dd/mm/yyyy format
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
      const yyyy = today.getFullYear();
      const formattedDate = dd + '/' + mm + '/' + yyyy;

      // Update the Example Quote section with professional-looking quote details
      document.getElementById('quoteContent').innerHTML = `
        <h3>PHNXX Pte. Ltd.</h3>
        <p>
          121 King St, Melbourne VIC 3000<br>
          Tel: (555) 123-4567 | Contact: <a href="https://www.phnxx.io/contact" target="_blank" style="color:inherit;">https://www.phnxx.io/contact</a>
        </p>
        <p>
          <strong>Quote Number:</strong> PHN-2025-001<br>
          <strong>Date:</strong> ${formattedDate}
        </p>
        <p>
          <strong>Customer:</strong><br>
          ${userData.customerName}<br>
          ${userData.customerAddress}
        </p>
        <hr>
        <h4>Residential Solar Panel Installation Quote</h4>
        <p>
          <strong>Project Overview:</strong><br>
          System Size: 5.5 kW (approx.)<br>
          Number of Panels: 18 x 305W Polycrystalline Panels<br>
          Inverter: 1 x 5.5 kW String Inverter<br>
          Mounting System: Roof-mounted, non-penetrating racking system<br>
          Estimated Annual Production: ~7,200 kWh/year
        </p>
        <p>
          <strong>Equipment & Installation Costs:</strong>
        </p>
        <ul>
          <li><strong>Solar Panels:</strong> 18 x 305W Polycrystalline Panels, Unit Price: $200 each, Total: $3,600</li>
          <li><strong>Inverter:</strong> 5.5 kW String Inverter, Price: $1,200</li>
          <li><strong>Mounting & Racking:</strong> Roof-mounted, non-penetrating racking system, Total: $800</li>
          <li><strong>Electrical Components:</strong> Wiring, combiner boxes, conduit, Total: $600</li>
          <li><strong>Installation Labor & Permitting:</strong> Design, installation, permits, Total: $1,500</li>
        </ul>
        <p>
          <strong>Subtotal:</strong> $7,700<br>
          <strong>Tax (8.5%):</strong> $654.50<br>
          <strong>Total:</strong> $8,354.50
        </p>
        <p>
          Note: Actual costs may vary based on site inspection, shipping to ${userData.location}, and final configuration.
        </p>
        <hr>
        <p>
          We also recommend our <strong>${userData.chosenSetup.name}</strong> setup:<br>
          ${userData.chosenSetup.description}<br>
          Estimated system cost based on your average requirement (${avgCapacity.toFixed(2)} kW): $${userData.setupCost}
        </p>
      `;
    }

    // Transition between steps
    function goToStep(stepId) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      const next = document.getElementById(stepId);
      if (next) next.classList.add('active');
    }

    // Generate a smooth path using quadratic curves.
    function generateSmoothPath(points) {
      if (points.length < 2) return "";
      let d = "M" + points[0].x + "," + points[0].y;
      for (let i = 1; i < points.length; i++) {
        const midX = (points[i-1].x + points[i].x) / 2;
        const midY = (points[i-1].y + points[i].y) / 2;
        d += " Q " + points[i-1].x + "," + points[i-1].y + " " + midX + "," + midY;
      }
      return d;
    }

    // Force the last point's Y to match the first point's Y for seamless looping.
    function forceEndToMatchStart(points) {
      if (points.length < 2) return points;
      points[points.length - 1].y = points[0].y;
      return points;
    }

    // Update the header chart with combined cost and solar curves plus data labels.
    // The curve starts at the center of the first Winter box (x=31.25) and ends at the center of the last Winter box (x=468.75).
    // Then we add a final point at x=31.25+500 = 531.25 to ensure seamless connection.
    function updateHeaderChart() {
      const mainCenters = [31.25, 125, 250, 375, 468.75];
      const extendedCenters = mainCenters.concat([31.25 + 500]);

      const costData = [
        userData.winterCost,
        userData.springCost,
        userData.summerCost,
        userData.autumnCost,
        userData.winterCost  // partial winter at end
      ];
      const solarData = [
        userData.solarRequirements.winter,
        userData.solarRequirements.spring,
        userData.solarRequirements.summer,
        userData.solarRequirements.autumn,
        userData.solarRequirements.winter
      ];
      costData.push(userData.winterCost);
      solarData.push(userData.solarRequirements.winter);

      const height = 100;
      const marginTop = 20;
      const marginBottom = 10;
      const plotHeight = height - marginTop - marginBottom;
      const maxVal = Math.max(...costData, ...solarData);

      let costPoints = [], solarPoints = [];
      for (let i = 0; i < extendedCenters.length; i++) {
        const x = extendedCenters[i];
        const yCost = marginTop + (plotHeight - (costData[i] / maxVal * plotHeight));
        const ySolar = marginTop + (plotHeight - (solarData[i] / maxVal * plotHeight));
        costPoints.push({ x, y: yCost });
        solarPoints.push({ x, y: ySolar });
      }

      costPoints = forceEndToMatchStart(costPoints);
      solarPoints = forceEndToMatchStart(solarPoints);

      const costPathStr = generateSmoothPath(costPoints);
      const solarPathStr = generateSmoothPath(solarPoints);

      document.getElementById('costPath').setAttribute('d', costPathStr);
      document.getElementById('solarPath').setAttribute('d', solarPathStr);

      const labelsGroup = document.getElementById('dataLabels');
      while (labelsGroup.firstChild) {
        labelsGroup.removeChild(labelsGroup.firstChild);
      }

      const svgNS = "http://www.w3.org/2000/svg";
      for (let i = 0; i < mainCenters.length; i++) {
        const costLabel = document.createElementNS(svgNS, "text");
        costLabel.setAttribute("x", costPoints[i].x.toString());
        costLabel.setAttribute("y", (costPoints[i].y - 10).toString());
        costLabel.setAttribute("font-size", "10");
        costLabel.setAttribute("fill", "steelblue");
        costLabel.setAttribute("text-anchor", "middle");
        costLabel.textContent = costData[i].toString();
        labelsGroup.appendChild(costLabel);

        const solarLabel = document.createElementNS(svgNS, "text");
        solarLabel.setAttribute("x", solarPoints[i].x.toString());
        solarLabel.setAttribute("y", (solarPoints[i].y + 20).toString());
        solarLabel.setAttribute("font-size", "10");
        solarLabel.setAttribute("fill", "tomato");
        solarLabel.setAttribute("text-anchor", "middle");
        solarLabel.textContent = solarData[i].toFixed(2);
        labelsGroup.appendChild(solarLabel);
      }
    }

    // Handle contact form submission (Step 4)
    function submitContact() {
      const name = document.getElementById('contactName').value;
      const email = document.getElementById('contactEmail').value;
      const message = document.getElementById('contactMessage').value;
      if (!name || !email || !message) {
        alert("Please fill in all contact fields.");
        return;
      }
      console.log("Contact submission:", { name, email, message });
      goToStep('step5');
    }
  </script>
</body>
</html>
